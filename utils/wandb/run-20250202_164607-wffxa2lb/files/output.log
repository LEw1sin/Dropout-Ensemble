2025-02-02 16:46:07,899 - INFO - Namespace(device='cuda:4', channel_weights=[1.0, 2.0, 1.0, 1.0], batch_size=8, num_classes=4, pretrained=False, pretrained_weights='./Synapse_weights_1u1d', lr=0.0001, epochs=500, warmup_epochs=10, dataset_mode='ACDC', max_channel=256, l2_norm=1e-07, patience=15, aug=False, wandb=True, cache=True, log_dir='../../de_logistics/ACDC_3UNetlinear_02-02-16-46-06/', log_file_path='../../de_logistics/ACDC_3UNetlinear_02-02-16-46-06/training.log')
Epoch 1/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:04<00:00,  1.17batch/s]
2025-02-02 16:47:17,044 - INFO - train_loss:1.3399110380808512 in epoch1
2025-02-02 16:47:17,045 - INFO - train_acc:0.34511009570594675 in epoch1
2025-02-02 16:47:17,045 - INFO - Epoch 1: Learning Rate: [2e-05]
Epoch 1/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.85batch/s]
2025-02-02 16:47:24,061 - INFO - valid_loss:1.276234140762916 in epoch1
2025-02-02 16:47:24,061 - INFO - valid_acc:0.4356967728010189 in epoch1
2025-02-02 16:47:24,062 - INFO - Mean iou = 33.95% in epoch1
2025-02-02 16:47:24,063 - INFO - save the model in epoch1
Epoch 2/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:03<00:00,  1.19batch/s]
2025-02-02 16:48:27,286 - INFO - train_loss:1.2309334484736125 in epoch2
2025-02-02 16:48:27,287 - INFO - train_acc:0.6299680585856691 in epoch2
2025-02-02 16:48:27,287 - INFO - Epoch 2: Learning Rate: [3e-05]
Epoch 2/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  1.98batch/s]
2025-02-02 16:48:33,863 - INFO - valid_loss:1.2015805152746348 in epoch2
2025-02-02 16:48:33,863 - INFO - valid_acc:0.7587093230999407 in epoch2
2025-02-02 16:48:33,863 - INFO - Mean iou = 63.88% in epoch2
2025-02-02 16:48:33,864 - INFO - save the model in epoch2
Epoch 3/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:03<00:00,  1.19batch/s]
2025-02-02 16:49:37,199 - INFO - train_loss:1.1970858510335287 in epoch3
2025-02-02 16:49:37,199 - INFO - train_acc:0.7492726062920734 in epoch3
2025-02-02 16:49:37,199 - INFO - Epoch 3: Learning Rate: [4e-05]
Epoch 3/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  1.98batch/s]
2025-02-02 16:49:43,782 - INFO - valid_loss:1.1822884449592004 in epoch3
2025-02-02 16:49:43,783 - INFO - valid_acc:0.8287432842805765 in epoch3
2025-02-02 16:49:43,783 - INFO - Mean iou = 72.47% in epoch3
2025-02-02 16:49:43,784 - INFO - save the model in epoch3
Epoch 4/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:03<00:00,  1.19batch/s]
2025-02-02 16:50:47,060 - INFO - train_loss:1.181510583559672 in epoch4
2025-02-02 16:50:47,060 - INFO - train_acc:0.8036523393659681 in epoch4
2025-02-02 16:50:47,060 - INFO - Epoch 4: Learning Rate: [5e-05]
Epoch 4/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  1.92batch/s]
2025-02-02 16:50:53,825 - INFO - valid_loss:1.1691908286168025 in epoch4
2025-02-02 16:50:53,826 - INFO - valid_acc:0.8272899307588002 in epoch4
2025-02-02 16:50:53,826 - INFO - Mean iou = 72.37% in epoch4
Epoch 5/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:02<00:00,  1.20batch/s]
2025-02-02 16:51:56,404 - INFO - train_loss:1.1717565472920735 in epoch5
2025-02-02 16:51:56,404 - INFO - train_acc:0.8437084254064089 in epoch5
2025-02-02 16:51:56,405 - INFO - Epoch 5: Learning Rate: [6e-05]
Epoch 5/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  2.04batch/s]
2025-02-02 16:52:02,786 - INFO - valid_loss:1.1640252333420973 in epoch5
2025-02-02 16:52:02,787 - INFO - valid_acc:0.8676478462411954 in epoch5
2025-02-02 16:52:02,787 - INFO - Mean iou = 77.86% in epoch5
2025-02-02 16:52:02,788 - INFO - save the model in epoch5
Epoch 6/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:02<00:00,  1.21batch/s]
2025-02-02 16:53:04,950 - INFO - train_loss:1.1678400468826293 in epoch6
2025-02-02 16:53:04,951 - INFO - train_acc:0.8598508702162392 in epoch6
2025-02-02 16:53:04,951 - INFO - Epoch 6: Learning Rate: [7e-05]
Epoch 6/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  1.95batch/s]
2025-02-02 16:53:11,622 - INFO - valid_loss:1.1618277843181903 in epoch6
2025-02-02 16:53:11,623 - INFO - valid_acc:0.8719584531244254 in epoch6
2025-02-02 16:53:11,623 - INFO - Mean iou = 78.31% in epoch6
2025-02-02 16:53:11,624 - INFO - save the model in epoch6
Epoch 7/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:04<00:00,  1.17batch/s]
2025-02-02 16:54:16,059 - INFO - train_loss:1.165097804069519 in epoch7
2025-02-02 16:54:16,059 - INFO - train_acc:0.8727802350501931 in epoch7
2025-02-02 16:54:16,059 - INFO - Epoch 7: Learning Rate: [8e-05]
Epoch 7/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.78batch/s]
2025-02-02 16:54:23,380 - INFO - valid_loss:1.159570235472459 in epoch7
2025-02-02 16:54:23,380 - INFO - valid_acc:0.8631773784234772 in epoch7
2025-02-02 16:54:23,380 - INFO - Mean iou = 77.24% in epoch7
Epoch 8/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 16:55:29,163 - INFO - train_loss:1.1622772868474325 in epoch8
2025-02-02 16:55:29,164 - INFO - train_acc:0.8874045338952681 in epoch8
2025-02-02 16:55:29,164 - INFO - Epoch 8: Learning Rate: [9e-05]
Epoch 8/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.85batch/s]
2025-02-02 16:55:36,201 - INFO - valid_loss:1.1595232486724854 in epoch8
2025-02-02 16:55:36,202 - INFO - valid_acc:0.8883442087472863 in epoch8
2025-02-02 16:55:36,202 - INFO - Mean iou = 80.76% in epoch8
2025-02-02 16:55:36,202 - INFO - save the model in epoch8
Epoch 9/500 [Training]: 100%|████████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 16:56:42,362 - INFO - train_loss:1.1617671378453573 in epoch9
2025-02-02 16:56:42,363 - INFO - train_acc:0.8897447843499516 in epoch9
2025-02-02 16:56:42,363 - INFO - Epoch 9: Learning Rate: [0.0001]
Epoch 9/500 [Validation]: 100%|██████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.79batch/s]
2025-02-02 16:56:49,641 - INFO - valid_loss:1.1551732466771052 in epoch9
2025-02-02 16:56:49,641 - INFO - valid_acc:0.8879349478435603 in epoch9
2025-02-02 16:56:49,641 - INFO - Mean iou = 80.79% in epoch9
Epoch 10/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.15batch/s]
2025-02-02 16:57:54,745 - INFO - train_loss:1.160796373685201 in epoch10
2025-02-02 16:57:54,746 - INFO - train_acc:0.8964728558112272 in epoch10
2025-02-02 16:57:54,746 - INFO - Epoch 10: Learning Rate: [0.0001]
Epoch 10/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.79batch/s]
2025-02-02 16:58:02,006 - INFO - valid_loss:1.155996900338393 in epoch10
2025-02-02 16:58:02,007 - INFO - valid_acc:0.8867022099780013 in epoch10
2025-02-02 16:58:02,007 - INFO - Mean iou = 80.71% in epoch10
Epoch 11/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 16:59:07,816 - INFO - train_loss:1.1601887973149618 in epoch11
2025-02-02 16:59:07,817 - INFO - train_acc:0.899908336545928 in epoch11
2025-02-02 16:59:07,818 - INFO - Epoch 11: Learning Rate: [9.999897245068351e-05]
Epoch 11/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:06<00:00,  1.90batch/s]
2025-02-02 16:59:14,659 - INFO - valid_loss:1.155709404211778 in epoch11
2025-02-02 16:59:14,660 - INFO - valid_acc:0.8993949815809581 in epoch11
2025-02-02 16:59:14,660 - INFO - Mean iou = 82.37% in epoch11
2025-02-02 16:59:14,661 - INFO - save the model in epoch11
Epoch 12/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 17:00:20,484 - INFO - train_loss:1.1587256161371866 in epoch12
2025-02-02 17:00:20,485 - INFO - train_acc:0.9096110486498602 in epoch12
2025-02-02 17:00:20,485 - INFO - Epoch 12: Learning Rate: [9.999588984497258e-05]
Epoch 12/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.81batch/s]
2025-02-02 17:00:27,683 - INFO - valid_loss:1.1530645718941321 in epoch12
2025-02-02 17:00:27,684 - INFO - valid_acc:0.9139618984027822 in epoch12
2025-02-02 17:00:27,684 - INFO - Mean iou = 84.72% in epoch12
2025-02-02 17:00:27,684 - INFO - save the model in epoch12
Epoch 13/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 17:01:33,410 - INFO - train_loss:1.158895713488261 in epoch13
2025-02-02 17:01:33,410 - INFO - train_acc:0.909083700456476 in epoch13
2025-02-02 17:01:33,411 - INFO - Epoch 13: Learning Rate: [9.999075230958104e-05]
Epoch 13/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.76batch/s]
2025-02-02 17:01:40,789 - INFO - valid_loss:1.1525422151272113 in epoch13
2025-02-02 17:01:40,790 - INFO - valid_acc:0.904111985034651 in epoch13
2025-02-02 17:01:40,790 - INFO - Mean iou = 83.20% in epoch13
Epoch 14/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 17:02:46,469 - INFO - train_loss:1.1586807823181153 in epoch14
2025-02-02 17:02:46,470 - INFO - train_acc:0.9119289940330102 in epoch14
2025-02-02 17:02:46,470 - INFO - Epoch 14: Learning Rate: [9.998356005569284e-05]
Epoch 14/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.73batch/s]
2025-02-02 17:02:53,967 - INFO - valid_loss:1.153215032357436 in epoch14
2025-02-02 17:02:53,968 - INFO - valid_acc:0.900763398145139 in epoch14
2025-02-02 17:02:53,968 - INFO - Mean iou = 82.71% in epoch14
Epoch 15/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:06<00:00,  1.13batch/s]
2025-02-02 17:04:00,135 - INFO - train_loss:1.1579839579264324 in epoch15
2025-02-02 17:04:00,137 - INFO - train_acc:0.9146017116931587 in epoch15
2025-02-02 17:04:00,137 - INFO - Epoch 15: Learning Rate: [9.99743133789534e-05]
Epoch 15/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.85batch/s]
2025-02-02 17:04:07,172 - INFO - valid_loss:1.1538026791352491 in epoch15
2025-02-02 17:04:07,173 - INFO - valid_acc:0.9137761604256233 in epoch15
2025-02-02 17:04:07,173 - INFO - Mean iou = 84.70% in epoch15
Epoch 16/500 [Training]: 100%|███████████████████████████████████████████████████████████████████| 75/75 [01:05<00:00,  1.14batch/s]
2025-02-02 17:05:13,123 - INFO - train_loss:1.1575810194015503 in epoch16
2025-02-02 17:05:13,124 - INFO - train_acc:0.9182491424512711 in epoch16
2025-02-02 17:05:13,124 - INFO - Epoch 16: Learning Rate: [9.996301265945735e-05]
Epoch 16/500 [Validation]: 100%|█████████████████████████████████████████████████████████████████| 13/13 [00:07<00:00,  1.76batch/s]
2025-02-02 17:05:20,508 - INFO - valid_loss:1.1517559014833891 in epoch16
2025-02-02 17:05:20,508 - INFO - valid_acc:0.9220674142397054 in epoch16
2025-02-02 17:05:20,509 - INFO - Mean iou = 86.03% in epoch16
2025-02-02 17:05:20,509 - INFO - save the model in epoch16
Epoch 17/500 [Training]:  71%|███████████████████████████████████████████████▎                   | 53/75 [00:47<00:19,  1.12batch/s]
Traceback (most recent call last):
  File "/data2/lyw/deunet_mem_based/train.py", line 221, in <module>
    main(args, net)
  File "/data2/lyw/deunet_mem_based/train.py", line 69, in main
    train_acc, train_losses = train_epoch(args, net, optimizer, train_loader, device, epoch, scheduler)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data2/lyw/deunet_mem_based/train.py", line 140, in train_epoch
    train_losses, train_acc, _= process_epoch(args, net, train_loader, device, 'train', optimizer, scaler, scheduler)
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data2/lyw/deunet_mem_based/train.py", line 115, in process_epoch
    scaler.scale(loss).backward()
  File "/home/lyw/anaconda3/envs/unet/lib/python3.11/site-packages/torch/_tensor.py", line 581, in backward
    torch.autograd.backward(
  File "/home/lyw/anaconda3/envs/unet/lib/python3.11/site-packages/torch/autograd/__init__.py", line 347, in backward
    _engine_run_backward(
  File "/home/lyw/anaconda3/envs/unet/lib/python3.11/site-packages/torch/autograd/graph.py", line 825, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.26 GiB. GPU 4 has a total capacity of 23.68 GiB of which 1.14 GiB is free. Including non-PyTorch memory, this process has 22.49 GiB memory in use. Of the allocated memory 18.03 GiB is allocated by PyTorch, and 4.21 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
